<!DOCTYPE html>
<html>

<head>
	<title>Shopping Cart</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="assets/css/custom.css" />
	<script src="card.js"></script>
	<script src="sweetalert.min.js"></script>
	<link rel="stylesheet" type="text/css" href="sweetalert.css">
	<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/js/customjs.js"></script>
</head>

<body>

	<nav class="navbar">
		<div class="container">
			<a class="navbar-brand" href="#">Your online store</a>
			<div class="navbar-right">
				<div class="container minicart"></div>
			</div>
		</div>
	</nav>

	<div class="container-fluid breadcrumbBox text-center">
		<ol class="breadcrumb">
			<li><a href="#">Review</a></li>
			<li><a href="index.html">Order</a></li>
			<li class="active"><a href="#">Payment</a></li>
		</ol>
	</div>

	<div class="container text-center">
		4410 2154 3921 7629, 05 / 21, 074
		<form action="">
			<span>$40000 TWD</span>
			<input placeholder="Card number" type="text" name="number" id="number">
			<input placeholder="Full name" type="text" name="name" id="name">
			<input placeholder="MM/YY" type="text" name="expiry" id="expiry">
			<input placeholder="CVC" type="text" name="cvc" id="cvc">
		</form>
		<button id="pay">結帳</button>
		<br>
		<br>
		<br>
		<br>
		<div class="card-wrapper">
		</div>
	</div>
	<br>
	<br>
	<br>

	<script>
		$("#pay").click(function(){
			var form = new FormData();
			form.append("number", $("#number").val().replace(/ /g, ''));
			form.append("csc", $("#cvc").val());
			form.append("expire_month", $("#expiry").val().substring(0,2));
			form.append("expire_year", $("#expiry").val().substring(5,7));
			form.append("shop_id", "83627");
			form.append("total", "1");
			form.append("description", "venus");

			var settings = {
				"async": true,
				"crossDomain": true,
				"url": "http://140.113.89.233:3019/api/payments/?token=VENUS%40123123j2d23d5j31%40d12ddDdqw2d3d32dd1d",
				"method": "POST",
				"processData": false,
				"contentType": false,
				"mimeType": "multipart/form-data",
				"data": form
			}

			$.ajax(settings).done(function(response) {
				res = JSON.parse(response);
				swal({
					title: "Verify",
					text: "Please insert the 6-digits verify code from your phone",
					type: "input",
					showCancelButton: true,
					closeOnConfirm: false,
					animation: "slide-from-top",
					inputPlaceholder: "Verify Code"
				}, function(inputValue){
					if (inputValue === false)
					return false;
					var form = new FormData();
					form.append("code", inputValue);
					var settings = {
					  "async": true,
					  "crossDomain": true,
					  "url": "http://140.113.89.233:3019/api/payments/"+ res.msg.id.toString() +"/?token=VENUS%40123123j2d23d5j31%40d12ddDdqw2d3d32dd1d",
					  "method": "POST",
					  "processData": false,
					  "contentType": false,
					  "mimeType": "multipart/form-data",
					  "data": form,
					  "error": function(e){
						  console.log("error");
						  swal.showInputError("Verify Failed!");
						  return false;
					  },
					  "success": function(e){
						  swal("Nice!", "Thank you!");
						  console.log("success");
					  }
					}
					$.ajax(settings).success(function (r) {
					  console.log(r);
					});
				});
			});
		})

	</script>
	<script>
		var card = new Card({
			// a selector or DOM element for the form where users will
			// be entering their information
			form: 'form', // *required*
			// a selector or DOM element for the container
			// where you want the card to appear
			container: '.card-wrapper', // *required*

			width: 500, // optional — default 350px
			formatting: true, // optional - default true

			// Strings for translation - optional
			messages: {
				validDate: 'valid\ndate', // optional - default 'valid\nthru'
				monthYear: 'mm/yyyy', // optional - default 'month/year'
			},

			// Default placeholders for rendered fields - optional
			placeholders: {
				number: '•••• •••• •••• ••••',
				name: 'Full Name',
				expiry: '••/••',
				cvc: '•••'
			},

			// if true, will log helpful messages for setting up Card
			debug: false // optional - default false
		});
	</script>
	<!-- The popover content -->

	<div id="popover" style="display: none">
		<a href="#"><span class="glyphicon glyphicon-pencil"></span></a>
		<a href="#"><span class="glyphicon glyphicon-remove"></span></a>
	</div>

	<!-- JavaScript includes -->


</body>

</html>
